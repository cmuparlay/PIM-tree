# PIM-tree-baseline-jumppush-pushpull

This repository comprise two baselines of the PIM-tree: Jump-push-search based PIM skip list, Push-Pull only PIM skip list. Both baselines don't include
the optimization "Shadow Subtree", "Chunking", and "CPU-PIM pipeline".
The performance of these two baselines are used in the study of the impact of different optimizations.

## Note

1. Only `INSERT` and `PREDECESSOR` operations are supported for these two baselines.
2. This baseline use the same input file format as the PIM-tree. Please use the workload file generated by it.
3. These two baselines have a small DPU program that fits into DPU IRAM, therefore they don't divide it.
4. Selection between two algorithms are done by macro `JUMP_PUSH` and `PUSH_PULL` in `operation.hpp`.

## Requirements

This implementation was created to run the experiments in the paper. Current implementation of PIM-tree can only run on [UPMEM](https://www.upmem.com/) machines. This codeset is built on [UPMEM SDK](https://sdk.upmem.com/).

## Building

To build everything, enter the root of the cloned repository. You will need to change `NR_DPUS` in `Makefile` to the number of DPU modules on your machine before you start building. Then run your desired command listed below.

| Command | Description |
|---------|-------------|
|make | Compiles and links|
|make test | Compiles and start a test case|
|make clean | Cleans the previous compiled files|

The build produces files in `build` directory, which can be classfied into two types:
- Host program(`jump_push_skip_list_host`, `push_pull_skip_list_host`): The host application used to drive the system.
- DPU program(`jumppush_pushpull_skip_list_dpu`): Application run on the DPUs.

## Running

The basic structure for a running command is:

```
./build/jump_push_skip_list_host [--arguments]
./build/push_pull_skip_list_host [--arguments]
```

Please refer to the following list to set the arguments:

| Argument | Abbreviation | Used Scenario* | Usage Description |
|---------|-------------|-------------|-------------|
| `--file` | `-f` | F |Use `--file [init_file] [test_file]` to include the path of dataset files|
| `--length` | `-l` | T |Use `-l [init_length] [test_length]` to set the number of initializing and testing queries|
| `--predecessor` | `-p` | T |Use `-p [predecessor_ratio]` to set the ratio of Predecessor queries|
| `--insert` | `-i` | T |Use `-i [insert_ratio]` to set the ratio of Insert queries|
| `--nocheck` | `-c` | A |Stop checking the correctness of the tested data structure|
| `--noprint` | `-t` | A |Do not print timer name when timing|
| `--nodetail` | `-d` | A |Do not print detail|
| `--init_state` | NA | F |Enables efficient initialization (by always doing Push-Pull when initializing)|

Please refer to the following list for used scenarios*:

| Used Scenario Abbreviation | Scenario Description |
|---------|-------------|
| F | Testing with existing dataset files |
| T | Directly testing with self-set Zipfian workloads |
| A | Any time |


## Code Structure

This section will introduce the contents in each code file and how the codes are organized.

### ```/common``` (similar to the PIM-tree)

This directory contains the configurations of the hardware used and the data structure.

```common.h```: Numeric configurations of the data structure.

```settings.h```: Configuration for program modes. (whether to turn on (1) debugging (2) tracking of various metrics)

```task_base.h```: Macros defining the interface of DPU function calls (tasks sent between CPU and DPUs).

### ```/dpu``` (different from the PIM-tree)

This directory contains source codes used to build the DPU applications.

```dpu.c```: Main function for the DPU applications. Handling function calls (tasks) from the CPU host application.

```gc.h```: not used.

```l3.h```: Implementation of replicated upper part (L3 in our paper) with skip list.

```l2.h```: Implementation of randomly distributed lower part (L2 in our paper) with skip list.

```node_dpu.h```: Defining node classes used in Layer 3 and 2. There's no L1. Data nodes are absorbed by the upper L2 node. 

```storage.h```: Hash table and node maintenance.

### ```/host``` (similar to the PIM-tree)

This directory contains source codes used to build the CPU host application.

```host.cpp```: Main function for the CPU host application.

```operation.hpp```: Functions for database queries on the CPU host side.

### ```/pim_base/include```

These two baselines use a trimmed version of `pim_base` without support of CPU-DPU pipelining and workload generation.
Remaining parts are similar.